<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel | Bowen Football</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body { background: #0a1118; color: white; font-family: sans-serif; padding: 30px; }
        .admin-panel { max-width: 900px; margin: auto; background: #141d26; padding: 30px; border-radius: 12px; border: 1px solid #2d3844; }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 20px; }
        input, select { padding: 10px; background: #1c2732; border: 1px solid #2d3844; color: white; border-radius: 5px; }
        button { padding: 10px; background: #ff1e1e; color: white; border: none; cursor: pointer; font-weight: bold; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #2d3844; }
        textarea { width: 100%; height: 200px; background: #000; color: #00ff88; padding: 15px; font-family: monospace; margin-top: 15px; border: 1px solid #2d3844; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="adminContent" class="hidden">
    <div class="admin-panel">
        <h1>Admin Control Center</h1>
        
        <h2>Player Registration Approvals</h2>
        <button onclick="fetchCloudData()">Refresh Registrations</button>
        <div id="pendingPlayers">Loading data from Google Sheets...</div>

        <h3>Generated Code for index.js</h3>
        <p style="font-size: 12px; color: #8a9199;">Copy this and paste it into the "Initial Data Boot" section of your index.js:</p>
        <textarea id="jsOutput" readonly placeholder="Waiting for data..."></textarea>
    </div>
</div>

<script>
    (function() {
        const pass = prompt("Enter Admin Password:");
        if (pass === "Bowen2026") { 
            document.getElementById('adminContent').classList.remove('hidden');
            fetchCloudData();
        } else {
            alert("Access Denied");
            window.location.href = "index.html";
        }
    })();

    async function fetchCloudData() {
        const apiURL = 'https://sheetdb.io/api/v1/w2udchrb7xrnh';
        const container = document.getElementById('pendingPlayers');
        const codeBox = document.getElementById('jsOutput');

        try {
            const response = await fetch(apiURL);
            const data = await response.json();
            
            if (data.length === 0) {
                container.innerHTML = "<p>No registrations found in the sheet.</p>";
                return;
            }

            let html = '<table><tr><th>Name</th><th>Dept</th><th>Position</th></tr>';
            let code = "";
            const posMap = { 'GK': 'KEEPERS', 'DEF': 'DEFENDERS', 'MID': 'MIDFIELDERS', 'ST': 'STRIKERS' };

            data.forEach(p => {
                html += `<tr><td>${p.Name}</td><td>${p.Department}</td><td>${p.Position}</td></tr>`;
                const cat = posMap[p.Position] || 'STRIKERS';
                code += `addNewPlayer("${p.Name}", 0, 0, 0, 0, "${p.Department}", "${cat}");\n`;
            });

            html += '</table>';
            container.innerHTML = html;
            codeBox.value = code;
        } catch (e) {
            container.innerHTML = "Error connecting to SheetDB.";
        }
    }
</script>
</body>
</html>